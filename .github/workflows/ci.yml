name: CI/CD Pipeline

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

permissions:
  contents: read

jobs:
  # ============================================================================
  # Shell Script Linting (unique to this workflow)
  # ============================================================================
  shell-lint:
    name: üêö Shell Script Lint
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v5

      - name: Run shellcheck
        run: |
          find . \( -name "*.sh" -o -name "*.bash" \) \
            | grep -v -E "(node_modules|\.venv|\.git|vendor)" \
            | while read -r script; do
                echo "Linting: $script"
                shellcheck "$script" || true
              done

  # ============================================================================
  # Pipeline Summary
  # ============================================================================
  pipeline-success:
    name: ‚úÖ Pipeline Complete
    runs-on: ubuntu-latest
    needs: [shell-lint]
    if: always()
    steps:
      - name: Check pipeline status
        run: |
          echo "::notice::CI pipeline execution completed!"
          echo "=================================="
          echo "üìä Pipeline Execution Summary"
          echo "=================================="
          echo "Note: Specialized checks run in separate workflows:"
          echo "  - python.yml: Ruff, mypy, pytest"
          echo "  - terraform.yml: fmt, validate, TFLint, Terrascan, tfsec, Checkov"
          echo "  - security.yml: Gitleaks, Trivy, TruffleHog, Bandit, CodeQL"
          echo "  - dependencies.yml: SBOM, pip-audit, Grype"
          echo "  - yaml.yml: yamllint, Prettier"
          echo "  - dockerfile.yml: Hadolint"
          echo "  - actionlint.yml: GitHub Actions validation"
          echo "=================================="
